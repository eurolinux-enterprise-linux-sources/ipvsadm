From aaddbff8f8217bfbbd47994840d95af7b7514614 Mon Sep 17 00:00:00 2001
From: Alexander Holler <alexander.holler@xxxxxxxx>
Date: Mon, 9 Jan 2012 12:58:12 +0100
Subject: [PATCH 7/9] libipvs: Fix initialization of netlink (needed for IPv6)
 when the module ip_vs wasn't loaded.

The following happened when keepalived was started before the module for IPVS was loaded:

ipvs_init() failed => netlink got disabled.
modprobe_ipvs()
ipvs_init() => netlink was not tested again => no netlink => no IPv6

Fixed through testing netlink always in ipvs_init().

Signed-off-by: Simon Horman <horms@verge.net.au>
---
 libipvs/libipvs.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/libipvs/libipvs.c b/libipvs/libipvs.c
index 811ca84..c3c3b0a 100644
--- a/libipvs/libipvs.c
+++ b/libipvs/libipvs.c
@@ -124,6 +124,8 @@ int ipvs_init(void)
 	ipvs_func = ipvs_init;
 
 #ifdef LIBIPVS_USE_NL
+	try_nl = 1;
+
 	if (ipvs_nl_send_message(NULL, NULL, NULL) == 0) {
 		try_nl = 1;
 		return ipvs_getinfo();
-- 
1.8.1.4

